<Window x:Class="LiveCompanion.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:LiveCompanion.App.ViewModels"
        xmlns:views="clr-namespace:LiveCompanion.App.Views"
        Title="LiveCompanion"
        Width="1200" Height="780"
        MinWidth="800" MinHeight="500"
        Style="{StaticResource DarkWindowStyle}"
        WindowStartupLocation="CenterScreen">

    <!-- DataTemplate registry: maps ViewModel type â†’ View type -->
    <Window.Resources>
        <DataTemplate DataType="{x:Type vm:PerformanceViewModel}">
            <views:PerformanceView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SetlistViewModel}">
            <views:SetlistView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:ConfigViewModel}">
            <views:ConfigView />
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SetupViewModel}">
            <views:SetupView />
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Left nav bar (hidden in performance mode via Visibility on the Border) -->
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- â”€â”€ Left navigation sidebar â”€â”€ -->
        <!-- ColumnDefinition does not support Style/DataTrigger (not FrameworkElement),
             so we hide the Border itself and use Width=Auto on the column. -->
        <Border Grid.Column="0"
                Width="64"
                Visibility="{Binding IsPerformanceMode,
                    Converter={StaticResource BoolToCollapsedConverter}}"
                Background="{StaticResource BackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,1,0">
            <StackPanel VerticalAlignment="Top" Margin="0,16,0,0">

                <!-- Performance -->
                <Button Command="{Binding GoPerformanceCommand}"
                        ToolTip="Performance">
                    <Button.Content>
                        <StackPanel>
                            <TextBlock Text="ðŸŽ¸" FontSize="22" HorizontalAlignment="Center" />
                            <TextBlock Text="Stage" FontSize="9" HorizontalAlignment="Center"
                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,2,0,0" />
                        </StackPanel>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavButtonStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsNavPerformanceActive}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource AccentBlueBrush}" />
                                    <Setter Property="Background" Value="{StaticResource BackgroundElevatedBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Setlist -->
                <Button Command="{Binding GoSetlistCommand}"
                        ToolTip="Setlist">
                    <Button.Content>
                        <StackPanel>
                            <TextBlock Text="ðŸ“‹" FontSize="22" HorizontalAlignment="Center" />
                            <TextBlock Text="Setlist" FontSize="9" HorizontalAlignment="Center"
                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,2,0,0" />
                        </StackPanel>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavButtonStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsNavSetlistActive}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource AccentBlueBrush}" />
                                    <Setter Property="Background" Value="{StaticResource BackgroundElevatedBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Config -->
                <Button Command="{Binding GoConfigCommand}"
                        ToolTip="Song Editor">
                    <Button.Content>
                        <StackPanel>
                            <TextBlock Text="ðŸŽ¼" FontSize="22" HorizontalAlignment="Center" />
                            <TextBlock Text="Editor" FontSize="9" HorizontalAlignment="Center"
                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,2,0,0" />
                        </StackPanel>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavButtonStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsNavConfigActive}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource AccentBlueBrush}" />
                                    <Setter Property="Background" Value="{StaticResource BackgroundElevatedBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Setup -->
                <Button Command="{Binding GoSetupCommand}"
                        ToolTip="Hardware Setup">
                    <Button.Content>
                        <StackPanel>
                            <TextBlock Text="âš™ï¸" FontSize="22" HorizontalAlignment="Center" />
                            <TextBlock Text="Setup" FontSize="9" HorizontalAlignment="Center"
                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,2,0,0" />
                        </StackPanel>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource NavButtonStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsNavSetupActive}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource AccentBlueBrush}" />
                                    <Setter Property="Background" Value="{StaticResource BackgroundElevatedBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

            </StackPanel>
        </Border>

        <!-- â”€â”€ Main content area â”€â”€ -->
        <Grid Grid.Column="1">

            <!-- Content view (driven by ViewModel type via DataTemplate) -->
            <ContentControl Content="{Binding CurrentView}" />

            <!-- â”€â”€ Notification overlay â”€â”€ -->
            <Border VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    CornerRadius="0,0,6,6"
                    Margin="16,0,16,0"
                    Padding="16,12"
                    Panel.ZIndex="100"
                    Visibility="{Binding Notification.IsVisible,
                        Converter={StaticResource BoolToVisibleConverter}}">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{StaticResource AccentRedBrush}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Notification.IsError}" Value="False">
                                <Setter Property="Background" Value="{StaticResource AccentOrangeBrush}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="{Binding Notification.Message}"
                               VerticalAlignment="Center"
                               FontSize="14"
                               TextWrapping="Wrap"
                               Foreground="White" />
                    <Button Grid.Column="1"
                            Content="âœ•"
                            Command="{Binding Notification.DismissCommand}"
                            Style="{StaticResource IconButtonStyle}"
                            Foreground="White"
                            Margin="12,0,0,0" />
                </Grid>
            </Border>

        </Grid>
    </Grid>
</Window>
