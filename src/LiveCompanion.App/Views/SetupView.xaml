<UserControl x:Class="LiveCompanion.App.Views.SetupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:LiveCompanion.App.ViewModels"
             Background="{StaticResource BackgroundDeepBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource BackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1"
                Padding="24,16">
            <TextBlock Text="Hardware Setup" FontSize="22" FontWeight="Bold" />
        </Border>

        <!-- Scrollable content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24" MaxWidth="800">

                <!-- â”€â”€ AUDIO â”€â”€ -->
                <TextBlock Text="AUDIO" FontSize="13" FontWeight="SemiBold"
                           Foreground="{StaticResource AccentBlueBrush}" Margin="0,0,0,12" />

                <GroupBox Header="ASIO Driver">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Driver -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Driver"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <ComboBox Grid.Row="0" Grid.Column="1"
                                  ItemsSource="{Binding AsioDrivers}"
                                  SelectedItem="{Binding SelectedAsioDriver}"
                                  Margin="0,0,8,8" />
                        <Button Grid.Row="0" Grid.Column="2"
                                Content="ðŸ”„ Refresh"
                                Command="{Binding RefreshPortsCommand}"
                                Margin="0,0,0,8" />

                        <!-- Buffer size -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Buffer size (samples)"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <TextBox Grid.Row="1" Grid.Column="1"
                                 Text="{Binding BufferSize, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,8" />

                        <!-- Channels -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Metronome channel offset"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <TextBox Grid.Row="2" Grid.Column="1"
                                 Text="{Binding MetronomeChannel, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </GroupBox>

                <GroupBox Header="Volumes" Margin="0,0,0,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="40" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Master"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <Slider Grid.Row="0" Grid.Column="1"
                                Minimum="0" Maximum="1" TickFrequency="0.05"
                                Value="{Binding MasterVolume}" Margin="0,0,8,8" />
                        <TextBlock Grid.Row="0" Grid.Column="2"
                                   Text="{Binding MasterVolume, StringFormat=P0}"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Strong beat"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <Slider Grid.Row="1" Grid.Column="1"
                                Minimum="0" Maximum="1" TickFrequency="0.05"
                                Value="{Binding StrongBeatVolume}" Margin="0,0,8,8" />
                        <TextBlock Grid.Row="1" Grid.Column="2"
                                   Text="{Binding StrongBeatVolume, StringFormat=P0}"
                                   VerticalAlignment="Center" Margin="0,0,0,8"
                                   Foreground="{StaticResource TextSecondaryBrush}" />

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Weak beat"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <Slider Grid.Row="2" Grid.Column="1"
                                Minimum="0" Maximum="1" TickFrequency="0.05"
                                Value="{Binding WeakBeatVolume}" Margin="0,0,8,0" />
                        <TextBlock Grid.Row="2" Grid.Column="2"
                                   Text="{Binding WeakBeatVolume, StringFormat=P0}"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                    </Grid>
                </GroupBox>

                <Button Content="â–¶  Test Audio (4 beats)"
                        Command="{Binding TestAudioCommand}"
                        HorizontalAlignment="Left" Margin="0,0,0,20" />

                <Separator Margin="0,0,0,20" />

                <!-- â”€â”€ MIDI â”€â”€ -->
                <TextBlock Text="MIDI" FontSize="13" FontWeight="SemiBold"
                           Foreground="{StaticResource AccentBlueBrush}" Margin="0,0,0,12" />

                <GroupBox Header="Output Devices">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="80" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Header row -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Device"
                                   FontSize="11" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6" />
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="MIDI Port"
                                   FontSize="11" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="8,0,8,6" />
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Channel"
                                   FontSize="11" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6" />

                        <!-- Quad1 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Quad 1"
                                   VerticalAlignment="Center" Margin="0,0,0,6"
                                   Foreground="{StaticResource TextPrimaryBrush}" />
                        <ComboBox Grid.Row="1" Grid.Column="1"
                                  ItemsSource="{Binding MidiOutputPorts}"
                                  SelectedItem="{Binding Quad1PortName}"
                                  Margin="8,0,8,6" />
                        <TextBox Grid.Row="1" Grid.Column="2"
                                 Text="{Binding Quad1Channel, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,6" />

                        <!-- Quad2 -->
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Quad 2"
                                   VerticalAlignment="Center" Margin="0,0,0,6"
                                   Foreground="{StaticResource TextPrimaryBrush}" />
                        <ComboBox Grid.Row="2" Grid.Column="1"
                                  ItemsSource="{Binding MidiOutputPorts}"
                                  SelectedItem="{Binding Quad2PortName}"
                                  Margin="8,0,8,6" />
                        <TextBox Grid.Row="2" Grid.Column="2"
                                 Text="{Binding Quad2Channel, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,6" />

                        <!-- SSPD -->
                        <TextBlock Grid.Row="3" Grid.Column="0" Text="SSPD"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextPrimaryBrush}" />
                        <ComboBox Grid.Row="3" Grid.Column="1"
                                  ItemsSource="{Binding MidiOutputPorts}"
                                  SelectedItem="{Binding SspdPortName}"
                                  Margin="8,0,8,0" />
                        <TextBox Grid.Row="3" Grid.Column="2"
                                 Text="{Binding SspdChannel, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </GroupBox>

                <GroupBox Header="MIDI Input (Footswitch)" Margin="0,0,0,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Input Port"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" />
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding MidiInputPorts}"
                                  SelectedItem="{Binding MidiInputPort}" />
                    </Grid>
                </GroupBox>

                <GroupBox Header="MIDI Clock Targets" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox Content="Quad Cortex 1" IsChecked="{Binding ClockToQuad1}" Margin="0,0,24,0" />
                        <CheckBox Content="Quad Cortex 2" IsChecked="{Binding ClockToQuad2}" Margin="0,0,24,0" />
                        <CheckBox Content="Roland SSPD"   IsChecked="{Binding ClockToSspd}" />
                    </StackPanel>
                </GroupBox>

                <!-- MIDI Input Mappings -->
                <GroupBox Header="MIDI Input â†’ Action Mapping">
                    <StackPanel>
                        <Button Content="âž• Add mapping"
                                Command="{Binding AddMidiMappingCommand}"
                                HorizontalAlignment="Left" Margin="0,0,0,8" />

                        <!-- Header -->
                        <Grid Margin="0,0,0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="32" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Status" FontSize="10" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMutedBrush}" />
                            <TextBlock Grid.Column="1" Text="Channel" FontSize="10" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMutedBrush}" />
                            <TextBlock Grid.Column="2" Text="Data1" FontSize="10" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMutedBrush}" />
                            <TextBlock Grid.Column="3" Text="Data2" FontSize="10" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMutedBrush}" />
                            <TextBlock Grid.Column="4" Text="Action" FontSize="10" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMutedBrush}" />
                        </Grid>

                        <ItemsControl ItemsSource="{Binding InputMappings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:MidiMappingItemViewModel}">
                                    <Grid Margin="0,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="32" />
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0"
                                                 Text="{Binding StatusType, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,4,0" />
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding Channel, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,4,0" />
                                        <TextBox Grid.Column="2"
                                                 Text="{Binding Data1, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,4,0" />
                                        <TextBox Grid.Column="3"
                                                 Text="{Binding Data2, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,4,0" />
                                        <ComboBox Grid.Column="4"
                                                  ItemsSource="{x:Static vm:MidiActionValues.All}"
                                                  SelectedItem="{Binding Action}"
                                                  Margin="0,0,4,0" />
                                        <Button Grid.Column="5" Content="âœ•" Padding="4"
                                                Style="{StaticResource DangerButtonStyle}"
                                                Command="{Binding DataContext.RemoveMidiMappingCommand,
                                                    RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </GroupBox>

            </StackPanel>
        </ScrollViewer>

        <!-- Save footer -->
        <Border Grid.Row="2" Background="{StaticResource BackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0"
                Padding="24,12">
            <Button Content="ðŸ’¾  Save Configuration"
                    Style="{StaticResource AccentButtonStyle}"
                    Command="{Binding SaveCommand}"
                    HorizontalAlignment="Right"
                    FontSize="15" Padding="24,10" />
        </Border>
    </Grid>
</UserControl>
